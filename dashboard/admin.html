<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Manager - Admin</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .admin-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .admin-header {
            flex-shrink: 0;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .header-left h1 {
            color: #2c3e50;
            font-size: 28px;
            font-weight: 700;
            margin: 0 0 5px 0;
        }

        .header-left p {
            color: #6c757d;
            font-size: 14px;
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(107, 114, 128, 0.4);
        }

        /* Customer Manager Styles */
        .machine-id {
            font-family: 'Courier New', monospace;
            background: #f1f5f9;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .machine-id.placeholder {
            background: #fef3c7;
            color: #92400e;
            font-family: inherit;
        }

        .machine-id-input {
            width: 200px;
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .machine-id-input:disabled {
            background: #f3f4f6;
            color: #6b7280;
        }

        .license-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .license-active {
            background: #dcfce7;
            color: #166534;
        }

        .license-inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        .btn-update-machine-id {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 8px;
        }

        .btn-update-machine-id:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }

        .btn-update-machine-id:disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #6c757d;
            font-size: 12px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #da190b 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(244, 67, 54, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
        }

        .alert-info {
            background: #d1ecf1;
            border: 2px solid #17a2b8;
            color: #0c5460;
        }

        .progress-container {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #667eea;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .progress-text {
            text-align: center;
            color: #6c757d;
            font-size: 14px;
        }

        /* Obfuscation Section Styles */
        .obfuscation-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .obfuscation-info .info-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .obfuscation-info h3 {
            color: #92400e;
            margin: 0 0 10px 0;
            font-size: 18px;
        }

        .obfuscation-info p {
            color: #78350f;
            margin: 0 0 10px 0;
        }

        .obfuscation-info ul {
            color: #78350f;
            margin: 0;
            padding-left: 20px;
        }

        .obfuscation-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .action-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .action-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .card-header {
            background: #f8fafc;
            padding: 16px 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .card-header h4 {
            margin: 0 0 5px 0;
            color: #1f2937;
            font-size: 16px;
        }

        .card-header p {
            margin: 0;
            color: #6b7280;
            font-size: 14px;
        }

        .card-body {
            padding: 20px;
        }

        .file-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 16px;
        }

        .file-item {
            background: #f1f5f9;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #475569;
        }

        .security-levels {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 16px;
        }

        .level-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .level-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            min-width: 60px;
            text-align: center;
        }

        .level-badge.high {
            background: #dc2626;
            color: white;
        }

        .level-badge.medium {
            background: #f59e0b;
            color: white;
        }

        .level-badge.whitelist {
            background: #6b7280;
            color: white;
        }

        .obfuscation-progress {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-header h4 {
            margin: 0;
            color: #1f2937;
        }

        .obfuscation-progress .progress-bar {
            background: #e5e7eb;
            border-radius: 8px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .obfuscation-progress .progress-fill {
            background: linear-gradient(135deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 8px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
            min-width: 0;
        }

        .progress-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .obfuscation-progress .progress-text {
            color: #4b5563;
            font-weight: 500;
            text-align: left;
        }

        .progress-stats {
            display: flex;
            gap: 15px;
            font-size: 14px;
        }

        .obfuscation-results {
            background: #f0fdf4;
            border: 2px solid #22c55e;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .results-header h4 {
            margin: 0;
            color: #15803d;
        }

        .results-summary {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .results-actions {
            display: flex;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .obfuscation-actions {
                grid-template-columns: 1fr;
            }

            .progress-details {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .progress-stats {
                flex-wrap: wrap;
            }
        }

        .packages-list {
            margin-top: 20px;
        }

        .package-item {
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #dee2e6;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .package-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }

        .package-info {
            flex: 1;
        }

        .package-name {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .package-meta {
            font-size: 14px;
            color: #6c757d;
        }

        .package-actions {
            display: flex;
            gap: 10px;
        }

        .back-link {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .back-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
        }

        .back-link a:hover {
            text-decoration: underline;
        }

        .info-box {
            background: #e7f3ff;
            border: 2px solid #2196F3;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-box strong {
            color: #1976D2;
        }

        /* Table Styles */
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border: 2px solid #e2e8f0;
        }

        .customer-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .customer-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .customer-table th {
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .customer-table td {
            padding: 14px 12px;
            border-bottom: 1px solid #e2e8f0;
            vertical-align: middle;
        }

        .customer-table tbody tr:hover {
            background: #f8fafc;
        }

        .customer-table tbody tr:last-child td {
            border-bottom: none;
        }

        .customer-name {
            font-weight: 600;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .customer-date {
            color: #64748b;
            font-size: 13px;
            cursor: help;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .customer-date:hover {
            background: #f1f5f9;
            color: #334155;
        }

        .customer-size {
            color: #64748b;
            font-size: 13px;
            font-family: monospace;
        }

        .display-name-display {
            background: #f1f5f9;
            padding: 6px 10px;
            border-radius: 6px;
            display: inline-block;
            margin-bottom: 4px;
            color: #334155;
            font-size: 13px;
        }

        .display-name-input-cell {
            display: flex;
            gap: 4px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .display-name-input-cell input {
            padding: 4px 8px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 12px;
            font-family: inherit;
            flex: 1;
            min-width: 100px;
            max-width: 120px;
        }

        .display-name-input-cell input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .machine-id-cell {
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .machine-id-display {
            background: #f1f5f9;
            padding: 6px 10px;
            border-radius: 6px;
            display: inline-block;
            margin-bottom: 4px;
            color: #334155;
        }

        .machine-id-placeholder {
            background: #fef3c7;
            color: #92400e;
            font-family: inherit;
            font-style: italic;
        }

        .machine-id-input-cell {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .machine-id-input-cell input {
            flex: 1;
            padding: 6px 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .status-has-machine {
            background: #dcfce7;
            color: #166534;
        }

        .status-no-machine {
            background: #fee2e2;
            color: #991b1b;
        }

        .action-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-create-key {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-create-key:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-create-key:disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-download {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-download:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-delete {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-delete:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-upgrade {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }

        .btn-upgrade:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .btn-edit-machine {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .btn-edit-machine:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .btn-unlock {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .btn-unlock:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .btn-save {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }

        .btn-save:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .btn-refresh {
            background: #6b7280;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-refresh:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }

        /* Pagination Styles */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            border-radius: 0 0 12px 12px;
        }

        .pagination-info {
            color: #64748b;
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #374151;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            min-width: 40px;
            text-align: center;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-size: 14px;
        }

        .page-size-selector select {
            padding: 4px 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            background: white;
            font-size: 14px;
        }

        /* Layout adjustments for no-scroll */
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        .admin-container {
            height: 100vh;
            max-width: none;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .admin-header {
            flex-shrink: 0;
            margin-bottom: 20px;
            padding-bottom: 15px;
        }

        .section {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            margin-bottom: 0;
        }

        .table-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }

        .customer-table {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .customer-table thead {
            flex-shrink: 0;
        }

        .customer-table tbody {
            flex: 1;
            overflow-y: auto;
            display: block;
        }

        .customer-table thead tr,
        .customer-table tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        .customer-table th:nth-child(1),
        .customer-table td:nth-child(1) {
            width: 12%;
        }

        .customer-table th:nth-child(2),
        .customer-table td:nth-child(2) {
            width: 10%;
        }

        .customer-table th:nth-child(3),
        .customer-table td:nth-child(3) {
            width: 8%;
        }

        .customer-table th:nth-child(4),
        .customer-table td:nth-child(4) {
            width: 20%;
        }

        .customer-table th:nth-child(5),
        .customer-table td:nth-child(5) {
            width: 12%;
        }

        .customer-table th:nth-child(6),
        .customer-table td:nth-child(6) {
            width: 15%;
        }

        .customer-table th:nth-child(7),
        .customer-table td:nth-child(7) {
            width: 23%;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 40px 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .modal-header h2 {
            margin: 0;
            color: #2c3e50;
            font-size: 24px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 30px;
            color: #6c757d;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #f8f9fa;
            color: #dc3545;
        }

        .modal-body {
            padding: 30px 40px 40px;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .customer-info {
            background: #f8fafc;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
            border-left: 4px solid #667eea;
        }

        .customer-info p {
            margin: 8px 0;
            color: #374151;
        }

        .customer-info code {
            background: #e5e7eb;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .success-box {
            background: #dcfce7;
            border: 2px solid #16a34a;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .success-box h3 {
            color: #15803d;
            margin: 0 0 15px 0;
            font-size: 18px;
        }

        .success-box textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            border: 1px solid #16a34a;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: white;
            resize: vertical;
            margin-bottom: 15px;
        }

        .success-box button {
            width: 100%;
        }

        /* License Time Remaining Styles */
        .license-time {
            font-size: 13px;
            font-weight: 600;
            padding: 6px 10px;
            border-radius: 6px;
            text-align: center;
            display: inline-block;
            min-width: 80px;
        }

        .license-time.expired {
            background: #fee2e2;
            color: #991b1b;
        }

        .license-time.expiring-soon {
            background: #fef3c7;
            color: #92400e;
        }

        .license-time.active {
            background: #dcfce7;
            color: #166534;
        }

        .license-time.lifetime {
            background: #e0e7ff;
            color: #3730a3;
        }

        .license-time.no-license {
            background: #f3f4f6;
            color: #6b7280;
            font-style: italic;
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <div class="admin-header">
            <div class="header-content">
                <div class="header-left">
                    <h1>üë• Customer Manager</h1>
                    <p>Qu·∫£n l√Ω kh√°ch h√†ng, Machine ID v√† License Keys</p>
                </div>
                <div class="header-actions">
                    <button onclick="showAddCustomerModal()" class="btn btn-primary">
                        üë§ Th√™m Kh√°ch H√†ng
                    </button>
                    <button onclick="refreshPackages()" class="btn btn-success">
                        üîÑ L√†m M·ªõi
                    </button>
                    <a href="/" class="btn btn-secondary">
                        ‚Üê Quay L·∫°i Dashboard
                    </a>
                </div>
            </div>
        </div>

        <div id="alertContainer"></div>

        <!-- Customer Management Table Section -->
        <div class="section">
            <div class="section-title">
                <span>üë• Danh S√°ch Kh√°ch H√†ng</span>
            </div>

            <div class="table-container">
                <table class="customer-table" id="customerTable">
                    <thead>
                        <tr>
                            <th style="width: 120px; text-align: center;">üë§ T√™n Kh√°ch H√†ng</th>
                            <th style="width: 110px; text-align: center;">üìÖ Ng√†y T·∫°o</th>
                            <th style="width: 200px; text-align: center;">üè∑Ô∏è T√™n Ph·ª•</th>
                            <th style="width: 150px; text-align: center;">üÜî Machine ID</th>
                            <th style="width: 100px; text-align: center;">üìä Tr·∫°ng Th√°i</th>
                            <th style="width: 80px; text-align: center;">‚è∞ Th·ªùi Gian</th>
                            <th style="width: 200px;">‚ö° Thao T√°c</th>
                        </tr>
                    </thead>
                    <tbody id="customerTableBody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                                ƒêang t·∫£i danh s√°ch kh√°ch h√†ng...
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div class="pagination-container">
                    <div class="pagination-info">
                        <span id="paginationInfo">Hi·ªÉn th·ªã 0 - 0 c·ªßa 0 kh√°ch h√†ng</span>
                    </div>

                    <div class="pagination-controls">
                        <div class="page-size-selector">
                            <span>Hi·ªÉn th·ªã:</span>
                            <select id="pageSize" onchange="changePageSize()">
                                <option value="5">5</option>
                                <option value="10" selected>10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                            </select>
                            <span>/ trang</span>
                        </div>

                        <button class="pagination-btn" id="prevBtn" onclick="previousPage()" disabled>
                            ‚Üê Tr∆∞·ªõc
                        </button>

                        <div id="pageNumbers"></div>

                        <button class="pagination-btn" id="nextBtn" onclick="nextPage()" disabled>
                            Sau ‚Üí
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Add Customer Modal -->
    <div id="addCustomerModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë§ Th√™m Kh√°ch H√†ng M·ªõi</h2>
                <button onclick="closeAddCustomerModal()" class="modal-close">√ó</button>
            </div>

            <div class="modal-body">
                <div class="info-box">
                    <strong>üí° L∆∞u √Ω:</strong> Package s·∫Ω ƒë∆∞·ª£c t·∫°o v·ªõi <strong>Advanced Obfuscation</strong> t·ª± ƒë·ªông v√†
                    x√≥a d·ªØ li·ªáu nh·∫°y c·∫£m.
                    Code s·∫Ω ƒë∆∞·ª£c b·∫£o v·ªá v·ªõi HIGH security cho files quan tr·ªçng. License key s·∫Ω ƒë∆∞·ª£c t·∫°o sau khi kh√°ch
                    h√†ng g·ª≠i Machine ID.
                </div>

                <form id="buildForm">
                    <div class="form-group">
                        <label for="customerName">üë§ T√™n Kh√°ch H√†ng *</label>
                        <input type="text" id="customerName" placeholder="vd: customer001" required>
                        <small>T√™n duy nh·∫•t cho kh√°ch h√†ng</small>
                    </div>

                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill">0%</div>
                        </div>
                        <div class="progress-text" id="progressText">ƒêang x·ª≠ l√Ω...</div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" onclick="closeAddCustomerModal()" class="btn btn-secondary">
                            H·ªßy
                        </button>
                        <button type="submit" class="btn btn-primary">
                            üë§ T·∫°o Kh√°ch H√†ng
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- License History Modal -->
    <div id="licenseHistoryModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>üìã L·ªãch S·ª≠ License Key</h2>
                <button onclick="closeLicenseHistoryModal()" class="modal-close">√ó</button>
            </div>

            <div class="modal-body">
                <div class="customer-info">
                    <p><strong>üë§ Kh√°ch h√†ng:</strong> <span id="historyCustomerName"></span></p>
                    <div id="licenseStats"></div>
                </div>

                <div class="license-history-table">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8fafc;">
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e2e8f0;">üìÖ Ng√†y
                                    T·∫°o</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e2e8f0;">‚è∞ Th·ªùi
                                    H·∫°n</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e2e8f0;">üìä Tr·∫°ng
                                    Th√°i</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e2e8f0;">üìù Ghi
                                    Ch√∫</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e2e8f0;">üîë
                                    License Key</th>
                            </tr>
                        </thead>
                        <tbody id="licenseHistoryTableBody">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px; color: #6c757d;">
                                    ƒêang t·∫£i l·ªãch s·ª≠...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="modal-actions">
                    <button type="button" onclick="closeLicenseHistoryModal()" class="btn btn-secondary">
                        ƒê√≥ng
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Generate License Modal -->
    <div id="generateLicenseModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîë T·∫°o License Key</h2>
                <button onclick="closeLicenseModal()" class="modal-close">√ó</button>
            </div>

            <div class="modal-body">
                <div class="customer-info">
                    <p><strong>üë§ Kh√°ch h√†ng:</strong> <span id="licenseCustomerName"></span></p>
                    <p><strong>üÜî Machine ID:</strong> <code id="licenseMachineIdDisplay"></code></p>
                </div>

                <div class="form-group">
                    <label for="licenseType">üìÖ Lo·∫°i License *</label>
                    <select id="licenseType" onchange="toggleCustomFields()">
                        <option value="0.000694">üß™ Test - 1 ph√∫t</option>
                        <option value="0.00347">üß™ Test - 5 ph√∫t</option>
                        <option value="0.0208">üß™ Test - 30 ph√∫t</option>
                        <option value="0.0417">üß™ Test - 1 gi·ªù</option>
                        <option value="1">üìÖ Trial - 1 ng√†y</option>
                        <option value="3">üìÖ Trial - 3 ng√†y</option>
                        <option value="7">üìÖ Trial - 7 ng√†y</option>
                        <option value="15">üìÖ Basic - 15 ng√†y</option>
                        <option value="30" selected>üìÖ Monthly - 30 ng√†y</option>
                        <option value="60">üìÖ Extended - 60 ng√†y</option>
                        <option value="90">üìÖ Quarterly - 90 ng√†y</option>
                        <option value="180">üìÖ Half Year - 180 ng√†y</option>
                        <option value="365">üìÖ Yearly - 365 ng√†y</option>
                        <option value="-1">‚ôæÔ∏è Lifetime - Vƒ©nh vi·ªÖn</option>
                        <option value="custom-days">‚úèÔ∏è T√πy ch·ªânh s·ªë ng√†y...</option>
                        <option value="custom-minutes">‚è±Ô∏è T√πy ch·ªânh s·ªë ph√∫t (test)...</option>
                    </select>
                </div>

                <div class="form-group" id="customDaysGroup" style="display: none;">
                    <label for="customDays">üìÜ S·ªë Ng√†y T√πy Ch·ªânh *</label>
                    <input type="number" id="customDays" placeholder="Nh·∫≠p s·ªë ng√†y (1-3650)" min="1" max="3650">
                    <small>Nh·∫≠p s·ªë ng√†y t·ª´ 1 ƒë·∫øn 3650 (10 nƒÉm)</small>
                </div>

                <div class="form-group" id="customMinutesGroup" style="display: none;">
                    <label for="customMinutes">‚è±Ô∏è S·ªë Ph√∫t T√πy Ch·ªânh *</label>
                    <input type="number" id="customMinutes" placeholder="Nh·∫≠p s·ªë ph√∫t (1-1440)" min="1" max="1440">
                    <small>Nh·∫≠p s·ªë ph√∫t t·ª´ 1 ƒë·∫øn 1440 (24 gi·ªù) - Ch·ªâ d√πng ƒë·ªÉ test</small>
                </div>

                <div class="form-group">
                    <label>üõ†Ô∏è Tools ƒê∆∞·ª£c Ph√©p S·ª≠ D·ª•ng *</label>
                    <div class="tools-selection">
                        <div class="quick-select-buttons">
                            <button type="button" class="quick-select-btn" onclick="selectToolPreset('all')">
                                ‚≠ê Select All
                            </button>
                            <button type="button" class="quick-select-btn" onclick="selectToolPreset('none')">
                                ‚ùå Clear All
                            </button>
                            <button type="button" class="quick-select-btn" onclick="selectToolPreset('wildcard')">
                                ‚ôæÔ∏è Wildcard (*)
                            </button>
                        </div>

                        <div class="checkbox-group" id="toolsCheckboxGroup">
                            <!-- Dynamically loaded from config/tools.json -->
                            <p style="color: #999; text-align: center; padding: 20px;">Loading tools...</p>
                        </div>

                        <div class="selected-tools-preview">
                            <strong>üìã Tools ƒë√£ ch·ªçn:</strong>
                            <span id="selectedToolsPreview">Ch∆∞a ch·ªçn tool n√†o</span>
                        </div>
                    </div>
                </div>

                <input type="hidden" id="licenseMachineId">

                <div id="licenseResult" style="display: none;">
                    <div class="success-box">
                        <h3>‚úÖ License Key ƒê√£ T·∫°o:</h3>
                        <textarea id="licenseKeyText" readonly></textarea>
                        <button onclick="copyLicenseKey()" class="btn btn-success">üìã Copy Key</button>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" onclick="closeLicenseModal()" class="btn btn-secondary">
                        ƒê√≥ng
                    </button>
                    <button type="button" onclick="generateLicenseKey()" class="btn btn-primary"
                        id="generateLicenseBtn">
                        üîë T·∫°o License Key
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Upgrade Package Modal -->
    <div id="upgradePackageModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 550px;">
            <div class="modal-header">
                <h2>üîÑ N√¢ng C·∫•p Package</h2>
                <button onclick="closeUpgradeModal()" class="modal-close">√ó</button>
            </div>

            <div class="modal-body">
                <div class="customer-info">
                    <p><strong>üë§ Kh√°ch h√†ng:</strong> <span id="upgradeCustomerName"></span></p>
                    <p><strong>üÜî Machine ID:</strong> <code id="upgradeMachineId"></code></p>
                </div>

                <div class="info-box" style="background: #dcfce7; border-color: #22c55e; margin-bottom: 20px;">
                    <strong>‚úÖ Nh·ªØng g√¨ s·∫Ω ƒë∆∞·ª£c GI·ªÆ NGUY√äN:</strong>
                    <ul style="margin: 10px 0 0 20px; padding: 0;">
                        <li>Machine ID - <strong>GI·ªÆ NGUY√äN</strong></li>
                        <li>Secret Key - <strong>GI·ªÆ NGUY√äN</strong></li>
                        <li>License key c≈© - <strong>V·∫™N HO·∫†T ƒê·ªòNG</strong> ‚úÖ</li>
                    </ul>
                </div>

                <div class="info-box" style="background: #e0e7ff; border-color: #6366f1;">
                    <strong>üîÑ Thao t√°c s·∫Ω th·ª±c hi·ªán:</strong>
                    <ol style="margin: 10px 0 0 20px; padding: 0;">
                        <li>L∆∞u Secret Key c≈©</li>
                        <li>X√≥a package c≈©</li>
                        <li>T·∫°o package m·ªõi v·ªõi code m·ªõi nh·∫•t</li>
                        <li>Kh√¥i ph·ª•c Machine ID v√† Secret Key</li>
                    </ol>
                    <p style="margin-top: 10px; font-size: 13px; color: #4338ca;">
                        üí° Kh√°ch h√†ng ch·ªâ c·∫ßn t·∫£i package m·ªõi, license key c≈© v·∫´n d√πng ƒë∆∞·ª£c!
                    </p>
                </div>

                <div id="upgradeProgress" class="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="upgradeProgressFill">0%</div>
                    </div>
                    <div class="progress-text" id="upgradeProgressText">ƒêang x·ª≠ l√Ω...</div>
                </div>

                <div class="modal-actions">
                    <button type="button" onclick="closeUpgradeModal()" class="btn btn-secondary" id="upgradeCancelBtn">
                        ‚ùå H·ªßy
                    </button>
                    <button type="button" onclick="confirmUpgradePackage()" class="btn btn-primary"
                        id="upgradeConfirmBtn">
                        üîÑ X√°c Nh·∫≠n N√¢ng C·∫•p
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Toggle Machine ID field
        function toggleMachineIdField() {
            const machineBinding = document.getElementById('modalMachineBinding').checked;
            const machineIdGroup = document.getElementById('modalMachineIdGroup');
            const machineIdInput = document.getElementById('modalMachineId');

            if (machineBinding) {
                machineIdGroup.style.display = 'block';
                machineIdInput.required = true;
            } else {
                machineIdGroup.style.display = 'none';
                machineIdInput.required = false;
                machineIdInput.value = '';
            }
        }



        // Build package
        document.getElementById('buildForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const customerName = document.getElementById('customerName').value.trim();
            const obfuscate = true; // Always enable obfuscation for security

            if (!customerName) {
                showAlert('Vui l√≤ng nh·∫≠p t√™n kh√°ch h√†ng', 'error');
                return;
            }

            // Show progress
            document.getElementById('progressContainer').style.display = 'block';
            updateProgress(0, 'ƒêang kh·ªüi t·∫°o...');

            try {
                const response = await fetch('/api/admin/build-package', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        customerName,
                        licenseType: 30, // Default 30 days (not used until license generation)
                        machineBinding: true, // Always enable machine binding for security
                        obfuscate
                    })
                });

                const data = await response.json();

                if (data.success) {
                    updateProgress(100, 'Ho√†n th√†nh!');
                    showAlert(`‚úÖ T·∫°o package th√†nh c√¥ng!\nüì¶ Location: ${data.packagePath}\nüîê Secret Key: ${data.secretKey}`, 'success');

                    // Reset form and close modal
                    document.getElementById('buildForm').reset();

                    // Refresh list and close modal
                    setTimeout(() => {
                        refreshPackages();
                        document.getElementById('progressContainer').style.display = 'none';
                        closeAddCustomerModal();
                    }, 2000);
                } else {
                    updateProgress(0, 'L·ªói!');
                    showAlert('‚ùå ' + data.message, 'error');
                    setTimeout(() => {
                        document.getElementById('progressContainer').style.display = 'none';
                    }, 2000);
                }
            } catch (error) {
                updateProgress(0, 'L·ªói!');
                showAlert('‚ùå L·ªói: ' + error.message, 'error');
                setTimeout(() => {
                    document.getElementById('progressContainer').style.display = 'none';
                }, 2000);
            }
        });

        // Refresh packages list
        async function refreshPackages() {
            const tableBody = document.getElementById('customerTableBody');
            tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">ƒêang t·∫£i...</td></tr>';

            try {
                const response = await fetch('/api/admin/packages');
                const data = await response.json();

                if (data.success && data.packages.length > 0) {
                    // Load customer data to merge with packages
                    loadCustomerData().then(customers => {
                        console.log('üéØ Rendering packages with customer data:', customers);
                        // Prepare all customer data for pagination
                        allCustomers = data.packages.map(pkg => {
                            const customer = customers[pkg.name] || {};
                            const machineId = customer.machineId || 'PLACEHOLDER_MACHINE_ID';
                            const isPlaceholder = machineId === 'PLACEHOLDER_MACHINE_ID';
                            const isLocked = !isPlaceholder && (customer.machineIdLocked !== false);

                            console.log(`üì¶ Package: ${pkg.name}, Customer:`, customer, `Machine ID: ${machineId}, Placeholder: ${isPlaceholder}, Locked: ${isLocked}`);

                            return {
                                pkg,
                                customer,
                                machineId,
                                isPlaceholder,
                                isLocked
                            };
                        });

                        // Sort by package creation time (newest first)
                        allCustomers.sort((a, b) => {
                            const timeA = a.pkg.createdTime || 0;
                            const timeB = b.pkg.createdTime || 0;
                            return timeB - timeA; // Newest first
                        });

                        totalCustomers = allCustomers.length;
                        currentPage = 1; // Reset to first page
                        renderCurrentPage();
                    });
                } else {
                    allCustomers = [];
                    totalCustomers = 0;
                    tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">Ch∆∞a c√≥ kh√°ch h√†ng n√†o</td></tr>';
                    updatePaginationInfo();
                }
            } catch (error) {
                allCustomers = [];
                totalCustomers = 0;
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #dc3545;">L·ªói t·∫£i danh s√°ch</td></tr>';
                updatePaginationInfo();
            }
        }

        // Download package
        function downloadPackage(name) {
            window.location.href = `/api/admin/download-package/${name}`;
        }

        // Load customer data
        async function loadCustomerData() {
            console.log('üîÑ Loading customer data...');
            try {
                const response = await fetch('/api/admin/customers');
                const data = await response.json();

                if (data.success) {
                    console.log('‚úÖ Customer data loaded:', data.customers.length, 'customers');
                    // Convert array to object for easy lookup
                    const customersObj = {};
                    data.customers.forEach(customer => {
                        customersObj[customer.customerName] = customer;
                        console.log(`üìã Customer: ${customer.customerName}, Machine ID: ${customer.machineId}, Locked: ${customer.machineIdLocked}`);
                    });
                    return customersObj;
                }
                return {};
            } catch (error) {
                console.error('Error loading customer data:', error);
                return {};
            }
        }

        // Update Machine ID
        async function updateMachineId(customerName) {
            const input = document.getElementById(`machineId_${customerName}`);
            const machineId = input.value.trim();

            if (!machineId) {
                alert('Vui l√≤ng nh·∫≠p Machine ID');
                return;
            }

            if (machineId.length !== 16) {
                alert('Machine ID ph·∫£i c√≥ ƒë√∫ng 16 k√Ω t·ª±');
                return;
            }

            try {
                const response = await fetch('/api/admin/customers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        customerName,
                        machineId,
                        notes: `Updated from package management. Package exists.`
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('success', 'Machine ID ƒë√£ ƒë∆∞·ª£c l∆∞u v√† kh√≥a!');
                    // Add delay to ensure database is updated
                    setTimeout(() => {
                        refreshPackages(); // Reload to show updated state
                    }, 500);
                } else {
                    showToast('error', 'L·ªói: ' + data.error);
                }
            } catch (error) {
                showToast('error', 'L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        }

        // Edit Machine ID (for unlocked ones)
        function editMachineId(customerName, currentMachineId) {
            editMachineIdDirectly(customerName, currentMachineId);
        }

        // Direct edit function (used by both manual edit and unlock+edit)
        function editMachineIdDirectly(customerName, currentMachineId) {
            const newMachineId = prompt(`S·ª≠a Machine ID cho ${customerName}:`, currentMachineId);

            if (newMachineId !== null) {
                // User entered something (even if same as current)
                if (newMachineId.trim() === '') {
                    alert('Machine ID kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng');
                    return;
                }

                if (newMachineId.length !== 16) {
                    alert('Machine ID ph·∫£i c√≥ ƒë√∫ng 16 k√Ω t·ª±');
                    return;
                }

                // Always save and lock, even if same as current (because we unlocked it)
                updateMachineIdDirectWithLock(customerName, newMachineId);
            } else {
                // User cancelled, need to refresh to show locked state again
                showToast('info', 'ƒê√£ h·ªßy s·ª≠a. Machine ID v·∫´n ƒë∆∞·ª£c kh√≥a l·∫°i.');
                setTimeout(() => {
                    refreshPackages();
                }, 500);
            }
        }

        // Unlock Machine ID and immediately edit (admin function)
        async function unlockMachineId(customerName) {
            if (!confirm(`M·ªü kh√≥a ƒë·ªÉ s·ª≠a Machine ID cho ${customerName}?\n\nL∆∞u √Ω: Sau khi nh·∫≠p xong s·∫Ω t·ª± ƒë·ªông kh√≥a l·∫°i.`)) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/customers/${customerName}/unlock-machine-id`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        reason: 'Admin unlock for editing'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('success', 'Machine ID ƒë√£ ƒë∆∞·ª£c m·ªü kh√≥a!');

                    // Get current Machine ID and immediately start editing
                    setTimeout(() => {
                        // Find current customer data to get current Machine ID
                        const currentCustomer = allCustomers.find(c => c.pkg.name === customerName);
                        if (currentCustomer) {
                            editMachineIdDirectly(customerName, currentCustomer.machineId);
                        }
                    }, 500);
                } else {
                    showToast('error', 'L·ªói: ' + data.error);
                }
            } catch (error) {
                showToast('error', 'L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        }

        // Update Display Name
        async function updateDisplayName(customerName) {
            const input = document.getElementById(`displayName_${customerName}`);
            const displayName = input.value.trim();

            if (!displayName) {
                showToast('error', 'Vui l√≤ng nh·∫≠p t√™n ph·ª•');
                return;
            }

            try {
                const response = await fetch('/api/admin/customers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        customerName,
                        displayName,
                        notes: `Updated display name: ${displayName}`
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('success', 'L∆∞u t√™n ph·ª• th√†nh c√¥ng!');
                    setTimeout(() => {
                        refreshPackages(); // Reload to show updated display name
                    }, 500);
                } else {
                    showToast('error', 'L·ªói: ' + data.error);
                }
            } catch (error) {
                showToast('error', 'L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        }

        // Edit Display Name
        async function editDisplayName(customerName, currentDisplayName) {
            const newDisplayName = prompt('Nh·∫≠p t√™n ph·ª• m·ªõi:', currentDisplayName);

            if (newDisplayName === null) return; // User cancelled

            const trimmedName = newDisplayName.trim();
            if (!trimmedName) {
                showToast('error', 'T√™n ph·ª• kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng');
                return;
            }

            try {
                const response = await fetch('/api/admin/customers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        customerName,
                        displayName: trimmedName,
                        notes: `Updated display name: ${trimmedName}`
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('success', 'C·∫≠p nh·∫≠t t√™n ph·ª• th√†nh c√¥ng!');
                    setTimeout(() => {
                        refreshPackages(); // Reload to show updated display name
                    }, 500);
                } else {
                    showToast('error', 'L·ªói: ' + data.error);
                }
            } catch (error) {
                showToast('error', 'L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        }

        // Update Machine ID directly (original function for first-time setup)
        async function updateMachineIdDirect(customerName, machineId) {
            try {
                const response = await fetch('/api/admin/customers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        customerName,
                        machineId,
                        notes: `Updated Machine ID from package management.`
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('success', 'Machine ID ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!');
                    // Add delay to ensure database is updated
                    setTimeout(() => {
                        refreshPackages(); // Reload to show updated state
                    }, 500);
                } else {
                    showToast('error', 'L·ªói: ' + data.error);
                }
            } catch (error) {
                showToast('error', 'L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        }

        // Update Machine ID and automatically lock it (for edit operations)
        async function updateMachineIdDirectWithLock(customerName, machineId) {
            try {
                const response = await fetch('/api/admin/customers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        customerName,
                        machineId,
                        notes: `Machine ID updated and locked by admin.`
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('success', 'Machine ID ƒë√£ ƒë∆∞·ª£c l∆∞u v√† kh√≥a l·∫°i!');
                    // Add delay to ensure database is updated
                    setTimeout(() => {
                        refreshPackages(); // Reload to show updated state
                    }, 500);
                } else {
                    showToast('error', 'L·ªói: ' + data.error);
                }
            } catch (error) {
                showToast('error', 'L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        }

        // Generate license for customer - Open modal
        async function generateLicenseForCustomer(customerName) {
            // Find customer data to get Machine ID
            const customerData = allCustomers.find(c => c.pkg.name === customerName);
            if (!customerData || customerData.isPlaceholder) {
                showToast('error', 'C·∫ßn c√≥ Machine ID tr∆∞·ªõc khi t·∫°o license key!');
                return;
            }

            // Set customer info in modal
            document.getElementById('licenseCustomerName').textContent = customerName;
            document.getElementById('licenseMachineId').value = customerData.machineId;
            document.getElementById('licenseMachineIdDisplay').textContent = customerData.machineId;

            // Reset form
            document.getElementById('licenseType').value = '30';
            document.getElementById('customDaysGroup').style.display = 'none';
            document.getElementById('customMinutesGroup').style.display = 'none';
            document.getElementById('licenseResult').style.display = 'none';

            // Load tools from config
            await loadToolsForLicense();

            // Show modal
            document.getElementById('generateLicenseModal').style.display = 'flex';
        }

        // Debug reload function
        function debugReload() {
            console.log('üîÑ Manual debug reload triggered');
            console.log('üßπ Clearing any cached data...');
            // Force reload by clearing container first
            const container = document.getElementById('packagesList');
            container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">ƒêang t·∫£i l·∫°i...</div>';

            // Add delay to ensure clean reload
            setTimeout(() => {
                refreshPackages();
            }, 100);
        }

        // Show toast notification
        function showToast(type, message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 9999;
                transform: translateX(400px);
                transition: transform 0.3s ease;
                ${type === 'success' ? 'background: linear-gradient(135deg, #10b981, #059669);' : 'background: linear-gradient(135deg, #ef4444, #dc2626);'}
            `;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => toast.style.transform = 'translateX(0)', 100);
            setTimeout(() => {
                toast.style.transform = 'translateX(400px)';
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Delete package
        async function deletePackage(name) {
            if (!confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a package "${name}"?`)) {
                return;
            }

            try {
                const response = await fetch(`/api/admin/delete-package/${name}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    showAlert('‚úÖ ƒê√£ x√≥a package th√†nh c√¥ng', 'success');
                    refreshPackages();
                } else {
                    showAlert('‚ùå ' + data.message, 'error');
                }
            } catch (error) {
                showAlert('‚ùå L·ªói: ' + error.message, 'error');
            }
        }

        // Upgrade package - M·ªü modal x√°c nh·∫≠n
        let upgradeTargetCustomer = null;

        function upgradePackage(name) {
            // T√¨m customer data ƒë·ªÉ l·∫•y Machine ID
            const customerData = allCustomers.find(c => c.pkg.name === name);
            if (!customerData) {
                showAlert('‚ùå Kh√¥ng t√¨m th·∫•y th√¥ng tin kh√°ch h√†ng', 'error');
                return;
            }

            const { machineId, isPlaceholder } = customerData;

            if (isPlaceholder) {
                showAlert('‚ùå Kh√°ch h√†ng ch∆∞a c√≥ Machine ID. Vui l√≤ng nh·∫≠p Machine ID tr∆∞·ªõc khi n√¢ng c·∫•p.', 'error');
                return;
            }

            // L∆∞u th√¥ng tin ƒë·ªÉ d√πng khi confirm
            upgradeTargetCustomer = customerData;

            // Hi·ªÉn th·ªã th√¥ng tin trong modal
            document.getElementById('upgradeCustomerName').textContent = name;
            document.getElementById('upgradeMachineId').textContent = machineId;

            // Reset progress
            document.getElementById('upgradeProgress').style.display = 'none';
            document.getElementById('upgradeConfirmBtn').disabled = false;
            document.getElementById('upgradeCancelBtn').disabled = false;

            // M·ªü modal
            document.getElementById('upgradePackageModal').style.display = 'flex';
        }

        function closeUpgradeModal() {
            document.getElementById('upgradePackageModal').style.display = 'none';
            upgradeTargetCustomer = null;
        }

        // Close modal when clicking outside
        document.getElementById('upgradePackageModal').addEventListener('click', (e) => {
            if (e.target.id === 'upgradePackageModal') {
                closeUpgradeModal();
            }
        });

        async function confirmUpgradePackage() {
            if (!upgradeTargetCustomer) {
                showAlert('‚ùå Kh√¥ng t√¨m th·∫•y th√¥ng tin kh√°ch h√†ng', 'error');
                closeUpgradeModal();
                return;
            }

            const { pkg, machineId, customer } = upgradeTargetCustomer;
            const name = pkg.name;

            // Disable buttons v√† show progress
            document.getElementById('upgradeConfirmBtn').disabled = true;
            document.getElementById('upgradeCancelBtn').disabled = true;
            document.getElementById('upgradeConfirmBtn').textContent = '‚è≥ ƒêang x·ª≠ l√Ω...';
            document.getElementById('upgradeProgress').style.display = 'block';

            try {
                // Update progress
                updateUpgradeProgress(20, 'ƒêang x√≥a package c≈©...');

                const response = await fetch(`/api/admin/upgrade-package/${name}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        machineId: machineId,
                        licenseHistory: customer.licenseHistory || []
                    })
                });

                updateUpgradeProgress(80, 'ƒêang ho√†n t·∫•t...');

                const data = await response.json();

                if (data.success) {
                    updateUpgradeProgress(100, 'Ho√†n th√†nh!');

                    setTimeout(() => {
                        closeUpgradeModal();
                        // Hi·ªÉn th·ªã th√¥ng b√°o ph√π h·ª£p d·ª±a tr√™n vi·ªác secret key c√≥ ƒë∆∞·ª£c gi·ªØ kh√¥ng
                        if (data.secretKeyPreserved) {
                            showAlert(`‚úÖ N√¢ng c·∫•p package "${name}" th√†nh c√¥ng!\nüì¶ Package m·ªõi: ${data.packagePath}\n\nüîë License key c≈© V·∫™N HO·∫†T ƒê·ªòNG!\nKh√°ch h√†ng ch·ªâ c·∫ßn t·∫£i package m·ªõi.`, 'success');
                        } else {
                            showAlert(`‚úÖ N√¢ng c·∫•p package "${name}" th√†nh c√¥ng!\nüì¶ Package m·ªõi: ${data.packagePath}\n\n‚ö†Ô∏è C·∫ßn t·∫°o license key M·ªöI cho kh√°ch h√†ng!`, 'success');
                        }
                        refreshPackages();
                    }, 500);
                } else {
                    closeUpgradeModal();
                    showAlert('‚ùå L·ªói n√¢ng c·∫•p: ' + data.message, 'error');
                }
            } catch (error) {
                closeUpgradeModal();
                showAlert('‚ùå L·ªói: ' + error.message, 'error');
            }
        }

        function updateUpgradeProgress(percent, text) {
            document.getElementById('upgradeProgressFill').style.width = percent + '%';
            document.getElementById('upgradeProgressFill').textContent = percent + '%';
            document.getElementById('upgradeProgressText').textContent = text;
        }

        // Update progress
        function updateProgress(percent, text) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressFill').textContent = percent + '%';
            document.getElementById('progressText').textContent = text;
        }

        // Show alert
        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';
            alert.textContent = message;
            container.innerHTML = '';
            container.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 10000);
        }



        // Pagination variables
        let currentPage = 1;
        let pageSize = 10;
        let totalCustomers = 0;
        let allCustomers = [];

        // Pagination functions
        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSize').value);
            currentPage = 1;
            renderCurrentPage();
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                renderCurrentPage();
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(totalCustomers / pageSize);
            if (currentPage < totalPages) {
                currentPage++;
                renderCurrentPage();
            }
        }

        function goToPage(page) {
            currentPage = page;
            renderCurrentPage();
        }

        function updatePaginationInfo() {
            const totalPages = Math.ceil(totalCustomers / pageSize);
            const startItem = totalCustomers === 0 ? 0 : (currentPage - 1) * pageSize + 1;
            const endItem = Math.min(currentPage * pageSize, totalCustomers);

            document.getElementById('paginationInfo').textContent =
                `Hi·ªÉn th·ªã ${startItem} - ${endItem} c·ªßa ${totalCustomers} kh√°ch h√†ng`;

            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages || totalPages === 0;

            // Update page numbers
            renderPageNumbers(totalPages);
        }

        function renderPageNumbers(totalPages) {
            const pageNumbersContainer = document.getElementById('pageNumbers');
            pageNumbersContainer.innerHTML = '';

            if (totalPages <= 1) return;

            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

            // Adjust start if we're near the end
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            // Add first page and ellipsis if needed
            if (startPage > 1) {
                pageNumbersContainer.appendChild(createPageButton(1));
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.className = 'pagination-btn';
                    ellipsis.style.cursor = 'default';
                    pageNumbersContainer.appendChild(ellipsis);
                }
            }

            // Add visible page numbers
            for (let i = startPage; i <= endPage; i++) {
                pageNumbersContainer.appendChild(createPageButton(i));
            }

            // Add ellipsis and last page if needed
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.className = 'pagination-btn';
                    ellipsis.style.cursor = 'default';
                    pageNumbersContainer.appendChild(ellipsis);
                }
                pageNumbersContainer.appendChild(createPageButton(totalPages));
            }
        }

        function createPageButton(pageNum) {
            const button = document.createElement('button');
            button.textContent = pageNum;
            button.className = `pagination-btn ${pageNum === currentPage ? 'active' : ''}`;
            button.onclick = () => goToPage(pageNum);
            return button;
        }

        function renderCurrentPage() {
            const startIndex = (currentPage - 1) * pageSize;
            const endIndex = startIndex + pageSize;
            const pageCustomers = allCustomers.slice(startIndex, endIndex);

            const tableBody = document.getElementById('customerTableBody');

            if (pageCustomers.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">Kh√¥ng c√≥ kh√°ch h√†ng n√†o</td></tr>';
            } else {
                tableBody.innerHTML = pageCustomers.map(customerData => {
                    const { pkg, customer, machineId, isPlaceholder, isLocked } = customerData;

                    return `
                        <tr>
                            <td style="width: 120px; text-align: center;">
                                <div class="customer-name">
                                    üë§ ${pkg.name}
                                </div>
                            </td>
                            <td style="width: 110px; text-align: center;">
                                <div class="customer-date" title="${customerData.customer.createdAt ? new Date(customerData.customer.createdAt).toLocaleString('vi-VN') : 'Th·ªùi gian t·∫°o package: ' + customerData.pkg.created}">
                                    üìÖ ${formatCustomerDate(customerData.customer, customerData.pkg)}
                                </div>
                            </td>
                            <td style="width: 200px; text-align: center;">
                                ${customer.displayName ?
                            `<div class="display-name-display">${customer.displayName}</div>
                                    <button class="btn-small btn-edit-machine" onclick="editDisplayName('${pkg.name}', '${customer.displayName}')">‚úèÔ∏è S·ª≠a</button>` :
                            `<div class="display-name-input-cell">
                                        <input type="text" id="displayName_${pkg.name}" placeholder="Nh·∫≠p t√™n ph·ª•..." maxlength="50">
                                        <button class="btn-small btn-save" onclick="updateDisplayName('${pkg.name}')">üíæ L∆∞u</button>
                                    </div>`
                        }
                            </td>
                            <td style="width: 150px; text-align: center;" class="machine-id-cell">
                                ${isPlaceholder ?
                            `<div class="machine-id-input-cell">
                                        <input type="text" id="machineId_${pkg.name}" placeholder="Nh·∫≠p Machine ID..." maxlength="16">
                                        <button class="btn-small btn-save" onclick="updateMachineId('${pkg.name}')">üíæ L∆∞u</button>
                                    </div>` :
                            `<div class="machine-id-display">${machineId} ${isLocked ? 'üîí' : ''}</div>
                                    ${!isLocked ?
                                `<button class="btn-small btn-edit-machine" onclick="editMachineId('${pkg.name}', '${machineId}')">‚úèÔ∏è S·ª≠a</button>` :
                                `<button class="btn-small btn-unlock" onclick="unlockMachineId('${pkg.name}')">üîì M·ªü kh√≥a</button>`
                            }`
                        }
                            </td>
                            <td style="width: 100px; text-align: center;">
                                <span class="status-badge ${!isPlaceholder ? 'status-has-machine' : 'status-no-machine'}">
                                    ${!isPlaceholder ? '‚úÖ C√≥ Machine ID' : '‚ùå Ch∆∞a c√≥ Machine ID'}
                                </span>
                            </td>
                            <td style="width: 80px; text-align: center;">
                                ${(() => {
                            const timeRemaining = calculateLicenseTimeRemaining(customerData.customer);
                            return `<span class="license-time ${timeRemaining.class}" style="font-size: 12px;">${timeRemaining.text}</span>`;
                        })()}
                            </td>
                            <td style="width: 200px;">
                                <div class="action-buttons">
                                    ${!isPlaceholder ?
                            `<button class="btn-small btn-create-key" onclick="generateLicenseForCustomer('${pkg.name}')">
                                            üîë T·∫°o Key
                                        </button>` :
                            `<button class="btn-small btn-create-key" disabled>
                                            üîë T·∫°o Key
                                        </button>`
                        }
                                    <button class="btn-small btn-download" onclick="downloadPackage('${pkg.name}')">
                                        üì• T·∫£i File
                                    </button>
                                    <button class="btn-small" onclick="showLicenseHistory('${pkg.name}')" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white;">
                                        üìã L·ªãch S·ª≠
                                    </button>
                                    <button class="btn-small btn-delete" onclick="deletePackage('${pkg.name}')">
                                        üóëÔ∏è X√≥a
                                    </button>
                                    <button class="btn-small btn-upgrade" onclick="upgradePackage('${pkg.name}')" title="N√¢ng c·∫•p code m·ªõi, gi·ªØ Machine ID">
                                        üîÑ N√¢ng c·∫•p
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            updatePaginationInfo();
        }

        // Calculate license time remaining
        function calculateLicenseTimeRemaining(customer) {
            // Handle old data without licenseHistory
            if (!customer || !customer.licenseHistory || customer.licenseHistory.length === 0) {
                return {
                    text: 'Ch∆∞a c√≥ License',
                    class: 'no-license'
                };
            }

            // Find active license
            const activeLicense = customer.licenseHistory.find(l => l.isActive);
            if (!activeLicense) {
                return {
                    text: 'License h·∫øt h·∫°n',
                    class: 'expired'
                };
            }

            // Check if lifetime
            if (activeLicense.expiryDays === -1) {
                return {
                    text: '‚ôæÔ∏è Vƒ©nh vi·ªÖn',
                    class: 'lifetime'
                };
            }

            // Calculate expiry date from createdAt + expiryDays
            const createdAt = new Date(activeLicense.createdAt);
            const expiryDate = new Date(createdAt.getTime() + (activeLicense.expiryDays * 24 * 60 * 60 * 1000));

            const now = new Date();
            const diffMs = expiryDate - now;

            if (diffMs <= 0) {
                return {
                    text: 'ƒê√£ h·∫øt h·∫°n',
                    class: 'expired'
                };
            }

            const diffDays = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
            const diffHours = Math.ceil(diffMs / (1000 * 60 * 60));
            const diffMinutes = Math.ceil(diffMs / (1000 * 60));

            let text, cssClass;

            if (diffDays > 7) {
                text = `${diffDays} ng√†y`;
                cssClass = 'active';
            } else if (diffDays > 1) {
                text = `${diffDays} ng√†y`;
                cssClass = 'expiring-soon';
            } else if (diffHours > 1) {
                text = `${diffHours} gi·ªù`;
                cssClass = 'expiring-soon';
            } else if (diffMinutes > 0) {
                text = `${diffMinutes} ph√∫t`;
                cssClass = 'expiring-soon';
            } else {
                text = 'ƒê√£ h·∫øt h·∫°n';
                cssClass = 'expired';
            }

            return {
                text: text,
                class: cssClass
            };
        }

        // Format date function
        function formatCustomerDate(customer, pkg) {
            if (customer.createdAt) {
                const date = new Date(customer.createdAt);
                const now = new Date();
                const diffMs = now - date;
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

                if (diffDays === 0) {
                    return `H√¥m nay ${date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' })}`;
                } else if (diffDays === 1) {
                    return `H√¥m qua ${date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' })}`;
                } else if (diffDays < 7) {
                    return `${diffDays} ng√†y tr∆∞·ªõc`;
                } else {
                    return date.toLocaleString('vi-VN', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
            }
            return pkg.created; // Fallback to package creation time
        }

        // Modal functions
        function showAddCustomerModal() {
            document.getElementById('addCustomerModal').style.display = 'flex';
            document.getElementById('customerName').focus();
        }

        function closeAddCustomerModal() {
            document.getElementById('addCustomerModal').style.display = 'none';
            document.getElementById('buildForm').reset();
            document.getElementById('progressContainer').style.display = 'none';
        }

        // Close modal when clicking outside
        document.getElementById('addCustomerModal').addEventListener('click', (e) => {
            if (e.target.id === 'addCustomerModal') {
                closeAddCustomerModal();
            }
        });

        // License modal functions
        function toggleCustomFields() {
            const licenseType = document.getElementById('licenseType').value;
            const customDaysGroup = document.getElementById('customDaysGroup');
            const customMinutesGroup = document.getElementById('customMinutesGroup');

            if (licenseType === 'custom-days') {
                customDaysGroup.style.display = 'block';
                customMinutesGroup.style.display = 'none';
                document.getElementById('customDays').required = true;
                document.getElementById('customMinutes').required = false;
            } else if (licenseType === 'custom-minutes') {
                customDaysGroup.style.display = 'none';
                customMinutesGroup.style.display = 'block';
                document.getElementById('customDays').required = false;
                document.getElementById('customMinutes').required = true;
            } else {
                customDaysGroup.style.display = 'none';
                customMinutesGroup.style.display = 'none';
                document.getElementById('customDays').required = false;
                document.getElementById('customMinutes').required = false;
            }
        }

        // Load tools from config/tools.json
        async function loadToolsForLicense() {
            try {
                const response = await fetch('/api/tools');
                const data = await response.json();

                if (!data.tools || data.tools.length === 0) {
                    console.warn('No tools found in config');
                    return;
                }

                const container = document.getElementById('toolsCheckboxGroup');
                container.innerHTML = '';

                // Create checkbox for each tool
                data.tools.forEach((tool, index) => {
                    const label = document.createElement('label');
                    label.className = 'checkbox-item';

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = tool.id;
                    checkbox.id = `tool-${tool.id}`;
                    if (index === 0) checkbox.checked = true; // Check first tool by default
                    checkbox.onchange = updateToolSelection;

                    const div = document.createElement('div');
                    const span = document.createElement('span');
                    span.textContent = `${tool.icon || 'üõ†Ô∏è'} ${tool.name}`;

                    const small = document.createElement('small');
                    small.textContent = tool.description || '';

                    div.appendChild(span);
                    div.appendChild(small);
                    label.appendChild(checkbox);
                    label.appendChild(div);
                    container.appendChild(label);
                });

                // Add wildcard option
                const wildcardLabel = document.createElement('label');
                wildcardLabel.className = 'checkbox-item wildcard-option';

                const wildcardCheckbox = document.createElement('input');
                wildcardCheckbox.type = 'checkbox';
                wildcardCheckbox.value = '*';
                wildcardCheckbox.id = 'tool-wildcard';
                wildcardCheckbox.onchange = updateToolSelection;

                const wildcardDiv = document.createElement('div');
                const wildcardSpan = document.createElement('span');
                wildcardSpan.textContent = '‚ôæÔ∏è All Tools (Wildcard)';

                const wildcardSmall = document.createElement('small');
                wildcardSmall.textContent = 'Cho ph√©p s·ª≠ d·ª•ng t·∫•t c·∫£ tools hi·ªán t·∫°i v√† t∆∞∆°ng lai';

                wildcardDiv.appendChild(wildcardSpan);
                wildcardDiv.appendChild(wildcardSmall);
                wildcardLabel.appendChild(wildcardCheckbox);
                wildcardLabel.appendChild(wildcardDiv);
                container.appendChild(wildcardLabel);

                updateToolSelection();
            } catch (error) {
                console.error('Error loading tools:', error);
                document.getElementById('toolsCheckboxGroup').innerHTML = '<p style="color: red;">L·ªói t·∫£i tools</p>';
            }
        }

        // Tool selection functions
        function selectToolPreset(preset) {
            const checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');

            switch (preset) {
                case 'all':
                    checkboxes.forEach(cb => cb.checked = true);
                    break;
                case 'none':
                    checkboxes.forEach(cb => cb.checked = false);
                    break;
                case 'wildcard':
                    checkboxes.forEach(cb => cb.checked = false);
                    document.getElementById('tool-wildcard').checked = true;
                    break;
            }

            updateToolSelection();
        }

        function updateToolSelection() {
            const selected = [];
            const checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]:checked');

            checkboxes.forEach(cb => {
                if (cb.value === '*') {
                    selected.push('All Tools (Wildcard)');
                } else {
                    // Find tool name from checkbox label
                    const label = cb.closest('label');
                    const toolName = label.querySelector('span').textContent;
                    selected.push(toolName);
                }
            });

            const preview = document.getElementById('selectedToolsPreview');
            if (selected.length === 0) {
                preview.textContent = 'Ch∆∞a ch·ªçn tool n√†o';
                preview.style.color = '#dc3545';
            } else {
                preview.textContent = selected.join(', ');
                preview.style.color = '#388e3c';
            }
        }

        function closeLicenseModal() {
            document.getElementById('generateLicenseModal').style.display = 'none';
            document.getElementById('licenseResult').style.display = 'none';
            document.getElementById('licenseType').value = '30';

            // Reset tool selection
            selectToolPreset('none');
            toggleCustomFields();
        }

        async function generateLicenseKey() {
            const customerName = document.getElementById('licenseCustomerName').textContent;
            const machineId = document.getElementById('licenseMachineId').value;
            let licenseType = document.getElementById('licenseType').value;
            const btn = document.getElementById('generateLicenseBtn');

            // Handle custom values
            if (licenseType === 'custom-days') {
                const customDays = document.getElementById('customDays').value;
                if (!customDays || customDays < 1 || customDays > 3650) {
                    showToast('error', 'Vui l√≤ng nh·∫≠p s·ªë ng√†y h·ª£p l·ªá (1-3650)');
                    return;
                }
                licenseType = customDays;
            } else if (licenseType === 'custom-minutes') {
                const customMinutes = document.getElementById('customMinutes').value;
                if (!customMinutes || customMinutes < 1 || customMinutes > 1440) {
                    showToast('error', 'Vui l√≤ng nh·∫≠p s·ªë ph√∫t h·ª£p l·ªá (1-1440)');
                    return;
                }
                licenseType = customMinutes / 1440; // Convert to days
            }

            btn.disabled = true;
            btn.textContent = '‚è≥ ƒêang t·∫°o...';

            // Get allowed tools from checkboxes
            const checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]:checked');
            const allowedTools = Array.from(checkboxes).map(cb => cb.value);

            if (allowedTools.length === 0) {
                showToast('error', 'Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt tool');
                btn.disabled = false;
                btn.textContent = 'üîë T·∫°o License Key';
                return;
            }

            try {
                const response = await fetch(`/api/admin/customers/${customerName}/generate-license`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        expiryDays: parseFloat(licenseType),
                        allowedTools: allowedTools,
                        notes: `Generated from Customer Manager. ${licenseType == -1 ? 'Lifetime' : licenseType >= 1 ? licenseType + ' days' : (licenseType * 24 * 60).toFixed(0) + ' minutes'}. Tools: ${allowedTools.join(', ')}`
                    })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('licenseKeyText').value = data.licenseKey;
                    document.getElementById('licenseResult').style.display = 'block';

                    // Auto copy to clipboard
                    navigator.clipboard.writeText(data.licenseKey).then(() => {
                        showToast('success', 'License key ƒë√£ ƒë∆∞·ª£c t·∫°o v√† copy v√†o clipboard!');
                    });

                    // Refresh packages to show updated status
                    setTimeout(() => {
                        refreshPackages();
                    }, 1000);
                } else {
                    showToast('error', 'L·ªói: ' + data.error);
                }
            } catch (error) {
                showToast('error', 'L·ªói k·∫øt n·ªëi: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'üîë T·∫°o License Key';
            }
        }

        function copyLicenseKey() {
            const textarea = document.getElementById('licenseKeyText');
            textarea.select();
            document.execCommand('copy');
            showToast('success', 'License key ƒë√£ ƒë∆∞·ª£c copy!');
        }

        // Close modal when clicking outside
        document.getElementById('generateLicenseModal').addEventListener('click', (e) => {
            if (e.target.id === 'generateLicenseModal') {
                closeLicenseModal();
            }
        });

        // License history functions
        async function showLicenseHistory(customerName) {
            document.getElementById('historyCustomerName').textContent = customerName;
            document.getElementById('licenseHistoryModal').style.display = 'flex';

            // Clear previous data first
            document.getElementById('licenseStats').innerHTML = '<div style="text-align: center; color: #6c757d;">ƒêang t·∫£i...</div>';
            document.getElementById('licenseHistoryTableBody').innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: #6c757d;">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>';

            // Load license history
            try {
                // Add cache busting to prevent stale data
                const response = await fetch(`/api/admin/customers/${customerName}/license-history?t=${Date.now()}`);

                // Check if response is JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    throw new Error('Server tr·∫£ v·ªÅ HTML thay v√¨ JSON. C√≥ th·ªÉ server ƒëang restart.');
                }

                const data = await response.json();

                if (data.success) {
                    // Display stats
                    const stats = data.stats;
                    document.getElementById('licenseStats').innerHTML = `
                        <div style="display: flex; gap: 20px; margin-top: 10px;">
                            <span style="background: #e0e7ff; color: #3730a3; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                üìä T·ªïng: ${stats.total}
                            </span>
                            <span style="background: #dcfce7; color: #166534; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                ‚úÖ C√≤n h·∫°n: ${stats.active}
                            </span>
                            <span style="background: #fee2e2; color: #991b1b; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                ‚ùå H·∫øt h·∫°n: ${stats.expired}
                            </span>
                            <span style="background: #fef3c7; color: #92400e; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                ‚ôæÔ∏è Vƒ©nh vi·ªÖn: ${stats.lifetime}
                            </span>
                        </div>
                    `;

                    // Display history table
                    const tbody = document.getElementById('licenseHistoryTableBody');
                    if (data.history.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: #6c757d;">Ch∆∞a c√≥ l·ªãch s·ª≠ license</td></tr>';
                    } else {
                        tbody.innerHTML = data.history.map(license => {
                            const createdDate = new Date(license.createdAt);
                            const now = new Date();

                            let statusText, statusClass;
                            if (license.expiryDays === -1) {
                                statusText = '‚ôæÔ∏è Vƒ©nh vi·ªÖn';
                                statusClass = 'background: #e0e7ff; color: #3730a3;';
                            } else {
                                const expiryDate = new Date(createdDate.getTime() + (license.expiryDays * 24 * 60 * 60 * 1000));
                                if (license.isActive) {
                                    statusText = 'üü¢ ƒêang d√πng';
                                    statusClass = 'background: #dcfce7; color: #166534;';
                                } else if (expiryDate > now) {
                                    statusText = 'üü° C√≤n h·∫°n';
                                    statusClass = 'background: #fef3c7; color: #92400e;';
                                } else {
                                    statusText = 'üî¥ H·∫øt h·∫°n';
                                    statusClass = 'background: #fee2e2; color: #991b1b;';
                                }
                            }

                            return `
                                <tr style="border-bottom: 1px solid #e2e8f0;">
                                    <td style="padding: 12px; font-size: 13px;">
                                        ${createdDate.toLocaleString('vi-VN')}
                                    </td>
                                    <td style="padding: 12px; font-size: 13px;">
                                        ${license.expiryDays === -1 ? '‚ôæÔ∏è Vƒ©nh vi·ªÖn' : license.expiryDays + ' ng√†y'}
                                    </td>
                                    <td style="padding: 12px;">
                                        <span style="padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; ${statusClass}">
                                            ${statusText}
                                        </span>
                                    </td>
                                    <td style="padding: 12px; font-size: 13px; max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                                        ${license.notes || 'Kh√¥ng c√≥ ghi ch√∫'}
                                    </td>
                                    <td style="padding: 12px;">
                                        <code style="font-size: 11px; background: #f1f5f9; padding: 4px 6px; border-radius: 4px; cursor: pointer;" 
                                              onclick="copyToClipboard('${license.licenseKey}')" 
                                              title="Click ƒë·ªÉ copy">
                                            ${license.licenseKey.substring(0, 20)}...
                                        </code>
                                    </td>
                                </tr>
                            `;
                        }).join('');
                    }
                } else {
                    // Show error in modal instead of toast
                    document.getElementById('licenseStats').innerHTML = '<div style="color: #dc2626; text-align: center;">‚ùå L·ªói: ' + data.error + '</div>';
                    document.getElementById('licenseHistoryTableBody').innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: #dc2626;">‚ùå ' + data.error + '</td></tr>';
                    showToast('error', 'L·ªói t·∫£i l·ªãch s·ª≠: ' + data.error);
                }
            } catch (error) {
                // Show error in modal instead of toast
                document.getElementById('licenseStats').innerHTML = '<div style="color: #dc2626; text-align: center;">‚ùå L·ªói k·∫øt n·ªëi: ' + error.message + '</div>';
                document.getElementById('licenseHistoryTableBody').innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 40px; color: #dc2626;">‚ùå L·ªói k·∫øt n·ªëi: ' + error.message + '</td></tr>';
                showToast('error', 'L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        }

        function closeLicenseHistoryModal() {
            document.getElementById('licenseHistoryModal').style.display = 'none';
            // Clear data when closing to prevent stale data
            document.getElementById('licenseStats').innerHTML = '';
            document.getElementById('licenseHistoryTableBody').innerHTML = '';
            document.getElementById('historyCustomerName').textContent = '';
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('success', 'License key ƒë√£ ƒë∆∞·ª£c copy!');
            });
        }

        // Close modal when clicking outside
        document.getElementById('licenseHistoryModal').addEventListener('click', (e) => {
            if (e.target.id === 'licenseHistoryModal') {
                closeLicenseHistoryModal();
            }
        });

        // Load packages on page load
        refreshPackages();



        let obfuscationProcess = null;

        /**
         * Obfuscate critical files only
         */
        async function obfuscateCriticalFiles() {
            const btn = document.getElementById('btnObfuscateCritical');
            const originalText = btn.innerHTML;

            try {
                btn.disabled = true;
                btn.innerHTML = 'üîÑ ƒêang obfuscate...';

                showObfuscationProgress();
                updateObfuscationProgress(0, 'Kh·ªüi t·∫°o obfuscation cho files quan tr·ªçng...');

                const response = await fetch('/api/admin/obfuscate-critical', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();

                if (result.success) {
                    showObfuscationResults(result);
                    showAlert('success', 'üéØ Obfuscate critical files th√†nh c√¥ng!');
                } else {
                    throw new Error(result.error || 'Unknown error');
                }

            } catch (error) {
                console.error('Obfuscation error:', error);
                showAlert('error', `‚ùå L·ªói obfuscation: ${error.message}`);
                hideObfuscationProgress();
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        /**
         * Obfuscate full project
         */
        async function obfuscateFullProject() {
            const btn = document.getElementById('btnObfuscateFull');
            const originalText = btn.innerHTML;

            try {
                btn.disabled = true;
                btn.innerHTML = 'üîÑ ƒêang obfuscate...';

                showObfuscationProgress();
                updateObfuscationProgress(0, 'Kh·ªüi t·∫°o obfuscation to√†n b·ªô project...');

                const response = await fetch('/api/admin/obfuscate-full', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                // Handle streaming response
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n').filter(line => line.trim());

                    for (const line of lines) {
                        try {
                            const data = JSON.parse(line);

                            if (data.type === 'progress') {
                                updateObfuscationProgress(data.progress, data.message);
                                updateObfuscationStats(data.stats);
                            } else if (data.type === 'complete') {
                                showObfuscationResults(data.result);
                                showAlert('success', 'üîí Obfuscate full project th√†nh c√¥ng!');
                            } else if (data.type === 'error') {
                                throw new Error(data.error);
                            }
                        } catch (parseError) {
                            console.warn('Failed to parse chunk:', line);
                        }
                    }
                }

            } catch (error) {
                console.error('Full obfuscation error:', error);
                showAlert('error', `‚ùå L·ªói obfuscation: ${error.message}`);
                hideObfuscationProgress();
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        /**
         * Show obfuscation progress
         */
        function showObfuscationProgress() {
            document.getElementById('obfuscationProgress').style.display = 'block';
            document.getElementById('obfuscationResults').style.display = 'none';

            // Reset progress
            updateObfuscationProgress(0, 'ƒêang kh·ªüi t·∫°o...');
            updateObfuscationStats({ success: 0, skipped: 0, failed: 0 });
        }

        /**
         * Hide obfuscation progress
         */
        function hideObfuscationProgress() {
            document.getElementById('obfuscationProgress').style.display = 'none';
        }

        /**
         * Update obfuscation progress
         */
        function updateObfuscationProgress(progress, message) {
            const progressFill = document.getElementById('obfuscationProgressFill');
            const progressText = document.getElementById('obfuscationProgressText');

            progressFill.style.width = `${progress}%`;
            progressFill.textContent = `${Math.round(progress)}%`;
            progressText.textContent = message;
        }

        /**
         * Update obfuscation stats
         */
        function updateObfuscationStats(stats) {
            document.getElementById('successCount').textContent = stats.success || 0;
            document.getElementById('skippedCount').textContent = stats.skipped || 0;
            document.getElementById('failedCount').textContent = stats.failed || 0;
        }

        /**
         * Show obfuscation results
         */
        function showObfuscationResults(result) {
            hideObfuscationProgress();

            const resultsDiv = document.getElementById('obfuscationResults');
            const summaryDiv = document.getElementById('resultsSummary');

            // Create results summary
            const summary = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div style="text-align: center; padding: 15px; background: #dcfce7; border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: 700; color: #166534;">${result.stats?.success || 0}</div>
                        <div style="color: #166534;">Files Obfuscated</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #fef3c7; border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: 700; color: #92400e;">${result.stats?.skipped || 0}</div>
                        <div style="color: #92400e;">Files Skipped</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #fee2e2; border-radius: 8px;">
                        <div style="font-size: 24px; font-weight: 700; color: #991b1b;">${result.stats?.failed || 0}</div>
                        <div style="color: #991b1b;">Files Failed</div>
                    </div>
                </div>
                <div style="background: #f8fafc; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 13px;">
                    <strong>Output:</strong> ${result.outputPath || 'obfuscated-project/'}<br>
                    <strong>Duration:</strong> ${result.duration || 'N/A'}<br>
                    <strong>Security Level:</strong> ${result.securityLevel || 'Mixed (HIGH + MEDIUM)'}
                </div>
            `;

            summaryDiv.innerHTML = summary;
            resultsDiv.style.display = 'block';

            // Show action buttons if full project was obfuscated
            if (result.type === 'full') {
                document.getElementById('btnDownloadObfuscated').style.display = 'inline-flex';
                document.getElementById('btnCreateFromObfuscated').style.display = 'inline-flex';
            }
        }

        /**
         * Clear obfuscation results
         */
        function clearObfuscationResults() {
            document.getElementById('obfuscationResults').style.display = 'none';
            document.getElementById('btnDownloadObfuscated').style.display = 'none';
            document.getElementById('btnCreateFromObfuscated').style.display = 'none';
        }

        /**
         * Cancel obfuscation process
         */
        async function cancelObfuscation() {
            if (obfuscationProcess) {
                try {
                    await fetch('/api/admin/obfuscate-cancel', { method: 'POST' });
                    showAlert('info', 'üõë Obfuscation ƒë√£ ƒë∆∞·ª£c h·ªßy');
                } catch (error) {
                    console.error('Cancel error:', error);
                }
            }
            hideObfuscationProgress();
        }

        /**
         * Download obfuscated project
         */
        async function downloadObfuscatedProject() {
            try {
                const response = await fetch('/api/admin/download-obfuscated');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'obfuscated-project.zip';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);

                showAlert('success', 'üì¶ T·∫£i xu·ªëng obfuscated project th√†nh c√¥ng!');
            } catch (error) {
                console.error('Download error:', error);
                showAlert('error', `‚ùå L·ªói t·∫£i xu·ªëng: ${error.message}`);
            }
        }

        /**
         * Create customer package from obfuscated project
         */
        async function createCustomerPackageFromObfuscated() {
            const customerName = prompt('Nh·∫≠p t√™n kh√°ch h√†ng:');
            if (!customerName) return;

            try {
                const response = await fetch('/api/admin/create-package-from-obfuscated', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ customerName })
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('success', `üë§ T·∫°o customer package th√†nh c√¥ng: ${customerName}`);
                    refreshPackages(); // Refresh customer list
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Create package error:', error);
                showAlert('error', `‚ùå L·ªói t·∫°o package: ${error.message}`);
            }
        }
    </script>
</body>

</html>
<st yle>
    /* Tool Selection Styles */
    .checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    }

    .checkbox-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    background: white;
    border-radius: 6px;
    border: 1px solid #dee2e6;
    cursor: pointer;
    transition: all 0.2s ease;
    }

    .checkbox-item:hover {
    background: #e3f2fd;
    border-color: #2196f3;
    }

    .checkbox-item input[type="checkbox"] {
    margin: 0;
    transform: scale(1.2);
    }

    .checkbox-item span {
    font-weight: 500;
    color: #495057;
    }

    .checkbox-item input[type="checkbox"]:checked + span {
    color: #2196f3;
    font-weight: 600;
    }
    </style>
    < style>
        /* Enhanced Tool Selection Styles */
        .tools-selection {
        margin-top: 10px;
        }

        .quick-select-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e9ecef;
        }

        .quick-select-btn {
        padding: 6px 12px;
        border: 1px solid #dee2e6;
        background: white;
        border-radius: 20px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 500;
        transition: all 0.2s ease;
        color: #495057;
        }

        .quick-select-btn:hover {
        background: #e3f2fd;
        border-color: #2196f3;
        color: #2196f3;
        }

        .checkbox-group {
        gap: 12px !important;
        }

        .checkbox-item {
        align-items: flex-start !important;
        gap: 12px !important;
        padding: 12px 15px !important;
        }

        .checkbox-item > div {
        flex: 1;
        }

        .checkbox-item span {
        display: block;
        margin-bottom: 4px;
        }

        .checkbox-item small {
        color: #6c757d;
        font-size: 11px;
        line-height: 1.3;
        }

        .checkbox-item.wildcard-option {
        border: 2px solid #ff9800 !important;
        background: linear-gradient(135deg, #fff3e0, #ffffff) !important;
        }

        .checkbox-item.wildcard-option:hover {
        background: linear-gradient(135deg, #ffe0b2, #fff3e0) !important;
        border-color: #f57c00 !important;
        }

        .checkbox-item.wildcard-option input[type="checkbox"]:checked + div span {
        color: #f57c00 !important;
        }

        .selected-tools-preview {
        margin-top: 15px;
        padding: 12px 15px;
        background: #e8f5e8;
        border-radius: 8px;
        border: 1px solid #4caf50;
        font-size: 13px;
        }

        .selected-tools-preview strong {
        color: #2e7d32;
        }

        .selected-tools-preview span {
        color: #388e3c;
        font-weight: 500;
        }
        </style>