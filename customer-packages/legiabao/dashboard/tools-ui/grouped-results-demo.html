<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo K·∫øt Qu·∫£ G·ªôp Theo Username</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="nohu-tool.css">
    <style>
        body {
            padding: 20px;
            background: #f7fafc;
        }

        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .demo-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .demo-actions {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
</head>

<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>üìä Demo K·∫øt Qu·∫£ G·ªôp Theo Username</h1>
            <p>K·∫øt qu·∫£ ƒë∆∞·ª£c g·ªôp theo username, click v√†o s·ªë ·∫£nh ƒë·ªÉ xem t·∫•t c·∫£</p>
        </div>

        <div class="demo-actions">
            <button class="btn btn-primary" onclick="addSampleGroup('user123', 3)">
                ‚ûï Th√™m user123 (3 trang)
            </button>
            <button class="btn btn-primary" onclick="addSampleGroup('player456', 5)">
                ‚ûï Th√™m player456 (5 trang)
            </button>
            <button class="btn btn-primary" onclick="addSampleGroup('gamer789', 2)">
                ‚ûï Th√™m gamer789 (2 trang)
            </button>
            <button class="btn btn-danger" onclick="clearAll()">
                üóëÔ∏è X√≥a T·∫•t C·∫£
            </button>
        </div>

        <div class="form-section">
            <h3>üìä K·∫øt Qu·∫£ Automation</h3>
            <div class="results-table-wrapper">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Profile</th>
                            <th>T√†i Kho·∫£n</th>
                            <th>S·ªë Trang</th>
                            <th>Tr·∫°ng Th√°i</th>
                            <th>·∫¢nh Ch·ª•p</th>
                            <th>Th·ªùi Gian</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #a0aec0; padding: 40px;">
                                Ch∆∞a c√≥ k·∫øt qu·∫£. Click n√∫t tr√™n ƒë·ªÉ th√™m demo.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Screenshots Modal -->
        <div id="screenshotsModal" class="screenshots-modal" style="display: none;">
            <div class="modal-overlay" onclick="closeModal()"></div>
            <div class="modal-content-large">
                <div class="modal-header">
                    <h3 id="modalTitle">üì∑ ·∫¢nh Ch·ª•p M√†n H√¨nh</h3>
                    <button class="modal-close" onclick="closeModal()">√ó</button>
                </div>
                <div class="modal-body" id="modalScreenshotsGrid">
                    <!-- Screenshots will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const resultsData = {};
        const sites = ['Go99', 'NOHU', 'TT88', 'MMOO', '789P', '33WIN', '88VV'];

        function addSampleGroup(username, siteCount) {
            const profile = 'Profile Demo';
            const key = `${profile}_${username}`;

            // Initialize group
            if (!resultsData[key]) {
                resultsData[key] = {
                    profileName: profile,
                    username: username,
                    sites: [],
                    screenshots: [],
                    firstTimestamp: Date.now(),
                    lastTimestamp: Date.now()
                };
            }

            // Add random sites
            for (let i = 0; i < siteCount; i++) {
                const site = sites[i % sites.length];
                const status = Math.random() > 0.3 ? 'success' : 'error';
                const screenshot = `https://via.placeholder.com/400x300/667eea/ffffff?text=${site}`;

                resultsData[key].sites.push({
                    name: site,
                    status: status,
                    screenshot: screenshot,
                    timestamp: Date.now()
                });

                resultsData[key].screenshots.push({
                    site: site,
                    url: screenshot,
                    timestamp: Date.now()
                });
            }

            resultsData[key].lastTimestamp = Date.now();
            refreshTable();
        }

        function refreshTable() {
            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '';

            if (Object.keys(resultsData).length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: #a0aec0; padding: 40px;">
                            Ch∆∞a c√≥ k·∫øt qu·∫£. Click n√∫t tr√™n ƒë·ªÉ th√™m demo.
                        </td>
                    </tr>
                `;
                return;
            }

            Object.keys(resultsData).forEach(key => {
                const group = resultsData[key];
                const row = document.createElement('tr');

                // Count statuses
                const successCount = group.sites.filter(s => s.status === 'success').length;
                const errorCount = group.sites.filter(s => s.status === 'error').length;

                // Status summary
                let statusHtml = '';
                if (successCount > 0) statusHtml += `<span class="status-badge success">‚úÖ ${successCount}</span> `;
                if (errorCount > 0) statusHtml += `<span class="status-badge error">‚ùå ${errorCount}</span>`;

                // Screenshots preview
                const screenshotCount = group.screenshots.length;
                const screenshotHtml = `
                    <div class="screenshot-preview" onclick="openModal('${key}')">
                        <span class="screenshot-preview-icon">üì∑</span>
                        <span class="screenshot-preview-count">${screenshotCount} ·∫£nh</span>
                    </div>
                `;

                // Format time
                const time = new Date(group.lastTimestamp).toLocaleString('vi-VN');

                row.innerHTML = `
                    <td>${group.profileName}</td>
                    <td><strong>${group.username}</strong></td>
                    <td>${group.sites.length} trang</td>
                    <td>${statusHtml}</td>
                    <td>${screenshotHtml}</td>
                    <td>${time}</td>
                `;

                tbody.appendChild(row);
            });
        }

        function openModal(key) {
            const group = resultsData[key];
            const modal = document.getElementById('screenshotsModal');
            const title = document.getElementById('modalTitle');
            const grid = document.getElementById('modalScreenshotsGrid');

            title.textContent = `üì∑ ·∫¢nh Ch·ª•p - ${group.username} (${group.screenshots.length} ·∫£nh)`;

            grid.innerHTML = '<div class="screenshots-grid">';
            group.screenshots.forEach((screenshot, index) => {
                const time = new Date(screenshot.timestamp).toLocaleString('vi-VN');
                grid.innerHTML += `
                    <div class="screenshot-item">
                        <div class="screenshot-item-header">
                            <span class="screenshot-site-name">${screenshot.site}</span>
                            <span style="font-size: 12px; color: #718096;">#${index + 1}</span>
                        </div>
                        <img src="${screenshot.url}" 
                             onclick="window.open('${screenshot.url}', '_blank')"
                             alt="${screenshot.site}">
                        <div class="screenshot-item-footer">
                            ${time}
                        </div>
                    </div>
                `;
            });
            grid.innerHTML += '</div>';

            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('screenshotsModal').style.display = 'none';
        }

        function clearAll() {
            Object.keys(resultsData).forEach(key => delete resultsData[key]);
            refreshTable();
        }

        // Close on ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });
    </script>
</body>

</html>